{% extends "assets/xtrend/layout.html" %}

{% block title %} Search {% endblock %}

{% block styles %}
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.2.0/nouislider.min.css">
<style>
    #slider .noUi-base {
        background: #14679e;
    }
    #slider .noUi-background {
        background: white;
    }
    #slider .noUi-connect {
        background: white;
    }
</style>
{% endblock %}

{% block scripts %}
{% load static %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.2.0/nouislider.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/wnumb/1.1.0/wNumb.min.js"></script>
<script type="text/javascript" src="{% static 'xtrend/pickers.js' %}"></script>
<script>
    var slider = document.getElementById('slider');
    var globalSell = 0;
    var globalBuy = 0;

    function createSlider(pos) {
        var currVal = 250;
        if (slider.noUiSlider) {
            currVal = slider.noUiSlider.get();
            slider.noUiSlider.destroy();
        }
        noUiSlider.create(slider, {
            start: currVal,
            connect: pos,
            tooltips: true,
            step: 1,
            format: wNumb({
                decimals: 0,
                prefix: '$'
            }),
            range: {
                'min': 0,
                '10%': 10,
                '32.36%': 50,
                '50%': 100,
                '75%': 500,
                'max': 1000
            },
            pips: {
                mode: 'range',
                density: 3,
                format: wNumb({
                    decimals: 0,
                    prefix: '$'
                })
            },
        });
    }

    createSlider("upper");

    function showBuy() {
        createSlider("upper");
        $("#big-buttons").hide();
        $("#small-buttons").show();
        $("#small-sell-button").removeClass("primary");
        $("#small-sell-button").addClass("secondary");
        $("#small-buy-button").removeClass("secondary");
        $("#small-buy-button").addClass("primary");

        $(".sell").css("display","none");
        $(".buy").css("display","inherit");
        globalBuy = 1;
        globalSell = 0;
    }

    function showSell() {
        createSlider("lower");
        $("#big-buttons").hide();
        $("#small-buttons").show();
        $("#small-buy-button").removeClass("primary");
        $("#small-buy-button").addClass("secondary");
        $("#small-sell-button").removeClass("secondary");
        $("#small-sell-button").addClass("primary");

        $(".buy").css("display","none");
        $(".sell").css("display","inherit");
        globalSell = 1;
        globalBuy = 0;
    }

    function doSearch() {
        var instrument_ids = Array.from(chosenRics.values()).map(function(a){ return '&instrument_id=' + a; });
        var range = slider.noUiSlider.get();
        var days = document.getElementById('search-date').value;
        var sell = globalSell;
        var buy = globalBuy;

        var urlResults = instrument_ids
            + "&buy=" + buy
            + "&sell=" + sell
            + "&range=" + range.substring(1)
            + "&days=" + days;

        return "/coolbananas/xtrend/search/results?" + urlResults;
    }
</script>
{% endblock %}

{% block body %}
<div class="row">
    <div class="columns small-12">
        <h1 style="text-align: center;">Search</h1>
    </div>
</div>
<div style="height: 30px"></div>
<div id="big-buttons">
    <div style="height: 30px">
        <br>
    </div>
    <div class="row">
        <div class="columns small-12">
            <button class="button primary" id="big-buy-button" onclick="showBuy()" style="width: 100%; font-size: 30px;">
                I am looking to Buy stocks.
            </button>
        </div>
    </div>
    <div style="height: 30px">
        <br>
    </div>
    <div class="row">
        <div class="columns small-12">
            <button class="button primary" id="big-sell-button" onclick="showSell()" style="width: 100%; font-size: 30px;">
                I am looking to Sell stocks.
            </button>
        </div>
    </div>
</div>
<div id="small-buttons" style="display: none;">
    <div class="row">
        <div class="columns small-6">
            <button class="button primary" id="small-buy-button" onclick="showBuy()" style="width: 100%;">
                I am looking to Buy stocks.
            </button>
        </div>
        <div class="columns small-6">
            <button class="button primary" id="small-sell-button" onclick="showSell()" style="width: 100%;">
                I am looking to Sell stocks.
            </button>
        </div>
    </div>
</div>
<form id="search" action="javascript:window.location.href = doSearch();">
    <div class="row buy sell" style="display: none;">
        <div class="columns" id="ricpicker-container"></div>
    </div>
    <div class="row buy sell" style="display: none;">
        <div class="columns">
            <label>Share Price Range</label>
            <br />
            <br />
            <div id="slider"></div>
            <br />
            <br />
        </div>
    </div>
    <div class="row buy sell" style="display: none;">
        <div class="columns">
            <label>Days Since Last Update <i>(0 is don't care)</i>
                <input type="number" min="0" id="search-date" placeholder="0">
            </label>
        </div>
    </div>
    
    <div class="row buy sell" style="display: none;">
        <div class="columns" style="align-content: center; width: 100%;">
            <button class="button" type="submit" style="width: 100%;">Search</button>
        </div>
    </div>
</form>
<div class="row explore" style="display: none;">
    <div class="columns">
        <h5>Query:</h5>
    </div>
    <div class="columns">
        <pre id="explore-query"></pre>
    </div>
</div>
<br>
<div class="row explore" style="display: none;">
    <div class="columns">
        <h5>Result:</h5>
    </div>
    <div class="columns">
        <pre id="explore-result"></pre>
    </div>
</div>
{% endblock %}